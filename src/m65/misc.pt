from    testmc  import sym_tid
from    testmc.m6502 import  Machine
from    b8tool  import path
import  pytest

object_file = 'src/m65/misc.p'
R, S = Machine.rs(path.obj(object_file))

@pytest.mark.parametrize('f', [S.decw_sub, S.decw_dec], ids=sym_tid(S))
@pytest.mark.parametrize('val, result', [
    (0xFFFF, 0xFFFD), (0x8001, 0x7FFF), (0x7000, 0x6FFE), (0x0000, 0xFFFE),
])
def test_decw(m, f, val, result):
    m.depword(S.val, val)
    m.call(f)
    assert hex(result) == hex(m.word(S.val))
